---
/**
 * ArticleCTA.astro
 * Base-safe CTA component for GitHub Pages project sites.
 * - Accepts RAW internal paths like "/art" or "/art/"
 * - Auto-prefixes import.meta.env.BASE_URL exactly once
 * - Leaves absolute URLs untouched
 */
const {
  title = "Viewing Contemporary Works",
  text = "Explore the current body of work, editions, and featured pieces.",
  buttonLabel = "View the work",
  href = "/art",
} = Astro.props;

const base = (import.meta.env.BASE_URL || "/").replace(/\/$/, "") + "/";

const toHref = (value) => {
  if (!value || typeof value !== "string") return `${base}art/`;

  // Keep absolute/external links unchanged
  if (
    value.startsWith("http://") ||
    value.startsWith("https://") ||
    value.startsWith("mailto:") ||
    value.startsWith("tel:") ||
    value.startsWith("#")
  ) {
    return value;
  }

  // Normalize: remove any accidental double-base prefix
  const normalizedBaseNoTrail = base.replace(/\/$/, "");
  const withoutDouble =
    value.startsWith(`${normalizedBaseNoTrail}${normalizedBaseNoTrail}`)
      ? value.replace(`${normalizedBaseNoTrail}${normalizedBaseNoTrail}`, normalizedBaseNoTrail)
      : value;

  // Ensure leading slash for internal paths
  const raw = withoutDouble.startsWith("/") ? withoutDouble : `/${withoutDouble}`;

  // If caller already passed a base-prefixed internal path, return it (once)
  if (raw.startsWith(normalizedBaseNoTrail + "/")) {
    return raw.endsWith("/") ? raw : `${raw}/`;
  }

  // Otherwise prefix base once
  const combined = `${normalizedBaseNoTrail}${raw}`;
  return combined.endsWith("/") ? combined : `${combined}/`;
};

const finalHref = toHref(href);
---

<aside class="article-cta" aria-label="Article call to action">
  <h2 class="article-cta__title">{title}</h2>
  <p class="article-cta__text">{text}</p>
  <p class="article-cta__actions">
    <a class="article-cta__link" href={finalHref}>{buttonLabel}</a>
  </p>
</aside>
